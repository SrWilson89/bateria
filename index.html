<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batería Interactiva</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #222;
      color: #fff;
      touch-action: manipulation;
    }
    
    h1 {
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }
    
    .drum-kit {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 800px;
      gap: 20px;
      padding: 20px;
      perspective: 1000px;
    }
    
    .drum {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: all 0.05s;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
      border: 5px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .drum::before {
      content: '';
      position: absolute;
      width: 90%;
      height: 90%;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8);
    }
    
    .drum.active {
      transform: scale(0.95);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
    }
    
    .tom {
      background: linear-gradient(135deg, #d13838, #8e2525);
    }
    
    .snare {
      background: linear-gradient(135deg, #e0e0e0, #b0b0b0);
    }
    
    .kick {
      background: linear-gradient(135deg, #3838d1, #25258e);
      width: 150px;
      height: 150px;
    }
    
    .hi-hat {
      background: linear-gradient(135deg, #d1d138, #8e8e25);
    }
    
    .crash {
      background: linear-gradient(135deg, #d138d1, #8e258e);
    }
    
    .ride {
      background: linear-gradient(135deg, #38d138, #258e25);
    }
    
    .key-label {
      font-size: 24px;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.8);
      z-index: 2;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
    }
    
    .drum-name {
      position: absolute;
      bottom: -35px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .instructions {
      margin-top: 50px;
      text-align: center;
      color: #ddd;
      max-width: 600px;
      line-height: 1.6;
    }
    
    @media (max-width: 600px) {
      .drum-kit {
        gap: 10px;
      }
      
      .drum {
        width: 90px;
        height: 90px;
      }
      
      .kick {
        width: 110px;
        height: 110px;
      }
      
      .key-label {
        font-size: 18px;
      }
    }
    
    .drum-layout {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 30px;
      margin-top: 30px;
    }
    
    .cymbal-row {
      grid-column: span 3;
      display: flex;
      justify-content: space-around;
    }
    
    .tom-row {
      grid-column: span 3;
      display: flex;
      justify-content: space-around;
    }
    
    .bottom-row {
      grid-column: span 3;
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
    }

    .status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 5px;
      background: rgba(0, 0, 0, 0.3);
      display: none;
    }
    
    .status.visible {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Batería Interactiva</h1>
  
  <div class="drum-layout">
    <div class="cymbal-row">
      <div class="drum crash" data-key="Q">
        <span class="key-label">Q</span>
        <div class="drum-name">Crash</div>
      </div>
      <div class="drum ride" data-key="E">
        <span class="key-label">E</span>
        <div class="drum-name">Ride</div>
      </div>
    </div>
    
    <div class="tom-row">
      <div class="drum tom" data-key="A">
        <span class="key-label">A</span>
        <div class="drum-name">Tom 1</div>
      </div>
      <div class="drum tom" data-key="S">
        <span class="key-label">S</span>
        <div class="drum-name">Tom 2</div>
      </div>
      <div class="drum tom" data-key="D">
        <span class="key-label">D</span>
        <div class="drum-name">Tom 3</div>
      </div>
    </div>
    
    <div class="bottom-row">
      <div class="drum hi-hat" data-key="Z">
        <span class="key-label">Z</span>
        <div class="drum-name">Hi-Hat</div>
      </div>
      <div class="drum kick" data-key="X">
        <span class="key-label">X</span>
        <div class="drum-name">Kick</div>
      </div>
      <div class="drum snare" data-key="C">
        <span class="key-label">C</span>
        <div class="drum-name">Snare</div>
      </div>
    </div>
  </div>

  <div id="status" class="status">Haz clic en cualquier parte para activar el audio</div>
  
  <div class="instructions">
    <p>Puedes tocar la batería de dos maneras:</p>
    <p>- Con el teclado: usa las teclas Q, E, A, S, D, Z, X, C</p>
    <p>- Con el ratón o dedo: toca directamente sobre los elementos de la batería</p>
  </div>
  
  <script>
    // Variables para Audio
    let audioContext;
    let audioInitialized = false;
    
    // Configuración de los sonidos
    const drumSounds = {
      'Q': { name: 'crash', type: 'cymbal', frequency: 800, decay: 1.5 },
      'E': { name: 'ride', type: 'cymbal', frequency: 600, decay: 2.0 },
      'A': { name: 'tom1', type: 'tom', frequency: 200, decay: 0.5 },
      'S': { name: 'tom2', type: 'tom', frequency: 150, decay: 0.5 },
      'D': { name: 'tom3', type: 'tom', frequency: 120, decay: 0.5 },
      'Z': { name: 'hihat', type: 'hihat', frequency: 1000, decay: 0.3 },
      'X': { name: 'kick', type: 'kick', frequency: 60, decay: 0.8 },
      'C': { name: 'snare', type: 'snare', frequency: 250, decay: 0.3 }
    };
    
    // Inicializar el AudioContext
    function initAudio() {
      if (!audioInitialized) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          audioInitialized = true;
          
          // Ocultar mensaje de estado
          document.getElementById('status').classList.remove('visible');
          
          // Eliminar listeners de inicialización
          document.removeEventListener('click', initAudio);
          document.removeEventListener('touchstart', initAudioTouch);
          document.removeEventListener('keydown', initAudioKey);
        } catch (e) {
          console.error('Error al inicializar Web Audio API:', e);
          document.getElementById('status').textContent = 'Error: Navegador no compatible con Web Audio API';
          document.getElementById('status').classList.add('visible');
        }
      }
    }
    
    function initAudioTouch(e) {
      initAudio();
      e.preventDefault();
    }
    
    function initAudioKey(e) {
      initAudio();
    }
    
    // Mostrar mensaje para activar audio
    document.getElementById('status').textContent = 'Haz clic en cualquier parte para activar el audio';
    document.getElementById('status').classList.add('visible');
    
    // Agregar listeners para inicializar audio
    document.addEventListener('click', initAudio);
    document.addEventListener('touchstart', initAudioTouch, { passive: false });
    document.addEventListener('keydown', initAudioKey);
    
    // Función para generar sonido de batería
    function createDrumSound(type, frequency, decay) {
      if (!audioContext) {
        initAudio();
        return;
      }
      
      const now = audioContext.currentTime;
      
      // Oscilador principal
      const osc = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      const filterNode = audioContext.createBiquadFilter();
      
      // Configurar nodo de ganancia (volumen)
      gainNode.gain.setValueAtTime(1, now);
      
      switch (type) {
        case 'kick':
          // Bombo: frecuencia baja con caída rápida
          osc.type = 'sine';
          osc.frequency.setValueAtTime(frequency, now);
          osc.frequency.exponentialRampToValueAtTime(20, now + 0.1);
          
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + decay);
          
          filterNode.type = 'lowpass';
          filterNode.frequency.setValueAtTime(400, now);
          break;
          
        case 'snare':
          // Caja: ruido con filtro
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(frequency, now);
          
          // Crear ruido para la caja
          const noiseNode = createNoiseNode();
          const noiseGain = audioContext.createGain();
          noiseGain.gain.setValueAtTime(0.5, now);
          noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
          
          filterNode.type = 'highpass';
          filterNode.frequency.setValueAtTime(800, now);
          
          noiseNode.connect(filterNode);
          filterNode.connect(audioContext.destination);
          
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
          break;
          
        case 'tom':
          // Tom: oscilador con filtro paso bajo
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(frequency, now);
          osc.frequency.exponentialRampToValueAtTime(frequency * 0.5, now + 0.1);
          
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + decay);
          
          filterNode.type = 'lowpass';
          filterNode.frequency.setValueAtTime(800, now);
          break;
          
        case 'hihat':
          // Hi-hat: ruido con filtro paso alto
          osc.type = 'square';
          osc.frequency.setValueAtTime(frequency, now);
          
          const hihatNoise = createNoiseNode();
          const hihatGain = audioContext.createGain();
          hihatGain.gain.setValueAtTime(0.3, now);
          hihatGain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
          
          const hihatFilter = audioContext.createBiquadFilter();
          hihatFilter.type = 'highpass';
          hihatFilter.frequency.setValueAtTime(3000, now);
          
          hihatNoise.connect(hihatFilter);
          hihatFilter.connect(audioContext.destination);
          
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
          break;
          
        case 'cymbal':
          // Platillo: ruido con filtro y resonancia
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(frequency, now);
          
          const cymbalNoise = createNoiseNode();
          const cymbalGain = audioContext.createGain();
          cymbalGain.gain.setValueAtTime(0.3, now);
          cymbalGain.gain.exponentialRampToValueAtTime(0.001, now + decay);
          
          const cymbalFilter = audioContext.createBiquadFilter();
          cymbalFilter.type = 'bandpass';
          cymbalFilter.frequency.setValueAtTime(frequency, now);
          cymbalFilter.Q.value = 5;
          
          cymbalNoise.connect(cymbalFilter);
          cymbalFilter.connect(audioContext.destination);
          
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
          break;
      }
      
      // Conectar oscilador principal
      osc.connect(gainNode);
      gainNode.connect(filterNode);
      filterNode.connect(audioContext.destination);
      
      osc.start(now);
      osc.stop(now + decay);
      
      return osc;
    }
    
    // Función para crear nodo de ruido (no está disponible nativamente en Web Audio API)
    function createNoiseNode() {
      const bufferSize = 2 * audioContext.sampleRate;
      const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      
      for (let i = 0; i < bufferSize; i++) {
        output[i] = Math.random() * 2 - 1;
      }
      
      const noise = audioContext.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;
      noise.start();
      
      return noise;
    }
    
    // Función para reproducir un sonido
    function playSound(key) {
      if (!audioInitialized) {
        initAudio();
        return;
      }
      
      if (key in drumSounds) {
        const sound = drumSounds[key];
        createDrumSound(sound.type, sound.frequency, sound.decay);
      }
    }
    
    // Función para manejar la animación visual
    function animateDrum(key) {
      const drum = document.querySelector(`.drum[data-key="${key}"]`);
      if (drum) {
        drum.classList.add('active');
        setTimeout(() => {
          drum.classList.remove('active');
        }, 100);
      }
    }
    
    // Función para reproducir el sonido y animar
    function triggerDrum(key) {
      key = key.toUpperCase();
      if (key in drumSounds) {
        playSound(key);
        animateDrum(key);
      }
    }
    
    // Event listener para teclado
    document.addEventListener('keydown', function(event) {
      const key = event.key.toUpperCase();
      if (key in drumSounds) {
        triggerDrum(key);
      }
    });
    
    // Event listeners para clics/toques
    const drums = document.querySelectorAll('.drum');
    drums.forEach(drum => {
      // Para ratón
      drum.addEventListener('mousedown', function() {
        const key = this.getAttribute('data-key');
        triggerDrum(key);
      });
      
      // Para pantallas táctiles
      drum.addEventListener('touchstart', function(e) {
        e.preventDefault();
        const key = this.getAttribute('data-key');
        triggerDrum(key);
      }, { passive: false });
    });
    
    // Evitar que los eventos de tocar la pantalla hagan scroll
    document.addEventListener('touchmove', function(e) {
      if (e.target.classList.contains('drum')) {
        e.preventDefault();
      }
    }, { passive: false });
  </script>
</body>
</html>